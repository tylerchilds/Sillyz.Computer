<!doctype html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <title>Silly'z HyperText</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="//cdn.quilljs.com/1.3.6/quill.bubble.css" rel="stylesheet">

    <link href="/static/totally.css" rel="stylesheet" />
<style>
  :root:is(html):is(html) {
    --bg: white;
    --fg: black;
  }
</style>
  </head>

  <body>
    <hyper-text></hyper-text>
    <script type="module">
      import tag from 'https://deno.land/x/tag@v0.2.0/mod.js';

      import actions from '/applications/hypertext/actions.js';
      import design from '/applications/hypertext/design.js';
      import develop from '/applications/hypertext/develop.js';
      import view from '/applications/hypertext/view.js';

      const flags = {
        path: window.location.pathname,
        hostname: window.location.hostname,
      }

      const $ = tag('hyper-text')

      $.render((target) => {
        if(!target.subscribers) {

          target.innerHTML = `
            <action-pane></action-pane>
            <develop-pane></develop-pane>
            <view-pane></view-pane>
            <design-pane"></design-pane>
          `

          const subrenders = [
            [actions, 'action-pane'],
            [develop, 'develop-pane'],
            [design, 'design-pane'],
            [view, 'view-pane'],
          ].map(([x, y]) => x(target.querySelector(y), $, flags))

          target.subscribers = subrenders.map(x => x.subscriber)
        }

        // state has changed, delegate
        notify(target.subscribers)
      })

      function notify(subscribers = []) {
        [...subscribers].map(x => x())
      }

      $.style(`
        & {
          display: grid;
          grid-template-areas:
            "actions actions actions"
            "develop   view   design";
          grid-template-columns: 1fr 1fr 1fr;
          grid-template-rows: auto 1fr;
        }

        & action-pane {
          grid-area: actions;
        }

        & develop-pane {
          grid-area: develop;
        }

        & view-pane {
          grid-area: view;
          width: 100%;
          border: none;
          height: 100%;
        }

        & design-pane {
          grid-area: design;
        }
      `)
    </script>
  </body>
</html>
